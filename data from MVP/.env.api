# =====================================================
# Power BI API Environment Configuration
# File: .env.api
# Purpose: Isolated environment for Power BI API middleware
# =====================================================

# ===========================================
# API SERVER CONFIGURATION
# ===========================================
NODE_ENV=production
API_PORT=3001
API_HOST=0.0.0.0

# ===========================================
# SUPABASE CONFIGURATION
# ===========================================
# These should match your main project configuration
SUPABASE_URL=http://supabase-kong:8000

# Service Role Key for dedicated API access (UPDATED 08AUG25)
# TODO: Replace with actual service role key from Supabase dashboard
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoic2VydmljZV9yb2xlIiwiaXNzIjoic3VwYWJhc2UiLCJpYXQiOjE3NDYwMjg4MDAsImV4cCI6MTkwMzc5NTIwMH0.cxqC53-nHZNmfpAnotR78L8S4a02IO38edeCUvcjTwU

# Fallback anonymous key (kept for compatibility)
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzQ2MDI4ODAwLCJleHAiOjE5MDM3OTUyMDB9.fPOIPmWEaaJgTJ5z-8XV12drkYhgfHi8rPUu5njf7M8

# For external testing (if needed)
SUPABASE_URL_EXTERNAL=http://10.135.3.144:8008

# ===========================================
# POWER BI TOKEN CONFIGURATION
# ===========================================
# Static part from your Power BI M-code
TOKEN_STATIC_PART=1aacc6d7c6180bef97d69489f584bd40

# Token expiry in hours
TOKEN_EXPIRY_HOURS=1

# ===========================================
# SECURITY SETTINGS
# ===========================================
# API secret for internal operations
API_SECRET=skillmatrix_powerbi_api_secret_2025_secure_key

# Rate limiting configuration
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Allowed IP addresses (comma-separated) - Added Docker internal IP and your external IP
ALLOWED_IPS=172.16.0.0/12,10.135.12.166,10.135.3.144,127.0.0.1,::1

# ===========================================
# LOGGING CONFIGURATION
# ===========================================
LOG_LEVEL=info
LOG_FILE=./logs/api.log
LOG_MAX_SIZE=10485760
LOG_MAX_FILES=5

# ===========================================
# CACHING CONFIGURATION
# ===========================================
# Redis configuration (optional)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Cache TTL in seconds
CACHE_TTL=300

# ===========================================
# CORS CONFIGURATION
# ===========================================
CORS_ORIGIN=*
CORS_CREDENTIALS=true

# ===========================================
# PERFORMANCE SETTINGS
# ===========================================
# Database connection pool
DB_POOL_MIN=2
DB_POOL_MAX=10

# Request timeout in milliseconds - increased for large datasets (400k+ rows)
REQUEST_TIMEOUT=900000
# Database query timeout for Supabase operations
DB_QUERY_TIMEOUT=900000
# Supabase Kong gateway timeout override
SUPABASE_TIMEOUT=900000

# ===========================================
# NOTES
# ===========================================
# This file is isolated from the main project
# Update SUPABASE_ANON_KEY with your actual key
# Update API_SECRET with a secure random key
# Adjust IP whitelist as needed for your environment